import { useState, type ReactNode } from "react";
import { Icon } from "@iconify/react";

type TreeViewProps = {
    children: ReactNode;
    className?: string;
};

type TreeViewCatalogProps = {
    title: string;
    children?: ReactNode;
    defaultOpen?: boolean;
    className?: string;
};

type TreeViewElementProps = {
    label: string;
    description?: string;
    className?: string;
};

const TreeViewBase = ({ children, className = "" }: TreeViewProps) => {
    return (
        <div
            className={`min-w-0 rounded-2xl border border-main-700/70 bg-main-900/50 p-3 ${className}`}
        >
            <div className="space-y-1">{children}</div>
        </div>
    );
};

const TreeViewCatalog = ({
    title,
    children,
    defaultOpen = false,
    className = "",
}: TreeViewCatalogProps) => {
    const [isOpen, setIsOpen] = useState(defaultOpen);

    return (
        <div className={`rounded-xl  ${className}`}>
            <button
                type="button"
                className="flex w-full items-center gap-2 rounded-lg px-2 py-1.5 text-left text-main-100 hover:bg-main-800/60 cursor-pointer"
                onClick={() => setIsOpen((prev) => !prev)}
            >
                <Icon
                    icon="mdi:chevron-right"
                    width={16}
                    height={16}
                    className={`shrink-0 text-main-300 transition-transform ${isOpen ? "rotate-90" : ""}`}
                />
                <Icon
                    icon={
                        isOpen
                            ? "mdi:folder-open-outline"
                            : "mdi:folder-outline"
                    }
                    width={16}
                    height={16}
                    className="shrink-0 text-main-300"
                />
                <span className="truncate text-sm font-medium">{title}</span>
            </button>

            {isOpen ? (
                <div className="mt-1 space-y-1 pl-7">{children}</div>
            ) : null}
        </div>
    );
};

const TreeViewElement = ({
    label,
    description,
    className = "",
}: TreeViewElementProps) => {
    return (
        <div
            className={`rounded-lg px-2 py-1.5 hover:bg-main-800/50 cursor-pointer ${className}`}
        >
            <div className="flex items-start gap-2">
                <Icon
                    icon="mdi:cog-outline"
                    width={14}
                    height={14}
                    className="mt-0.5 shrink-0 text-main-400"
                />
                <div className="min-w-0">
                    <p className="truncate text-xs font-medium text-main-200">
                        {label}
                    </p>
                    {description ? (
                        <p className="line-clamp-2 text-[11px] text-main-400">
                            {description}
                        </p>
                    ) : null}
                </div>
            </div>
        </div>
    );
};

export const TreeView = Object.assign(TreeViewBase, {
    Catalog: TreeViewCatalog,
    Element: TreeViewElement,
});
